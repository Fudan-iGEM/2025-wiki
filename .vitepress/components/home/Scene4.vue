<template>
  <div ref="scene4ContainerRef" class="scene4-container">
    <!-- Text box positioned on the left -->
    <div class="scene4-left-box-wrapper">
      <div ref="scene4LeftBoxRef" class="scene4-left-box">
        <h2 ref="scene4TitleRef" class="scene4-title"></h2>
        <p ref="scene4SubtitleRef" class="scene4-subtitle">
          <em>DR.sTraTeGY</em> -- Drug Resistance mutation Tracking Technology based on Grape Yeast<br><br>
A platform could accelerate antifungal drug development,<br>deepen our understanding of evolution,<br>and assist humanity’s defense against fungal threats
        </p>
      </div>
    </div>

    <!-- Glowing ball starts at the top left, near the box -->
    <div ref="glowingBallRef" class="glowing-ball"></div>

    <!-- Lottie animation (the dog) is the drop target in the bottom right -->
    <div ref="dropTargetRef" class="lottie-drop-target">
      <component
        v-if="lottieComponent && scene4AnimationUrl"
        :is="lottieComponent"
        ref="lottie4Ref"
        :animationLink="scene4AnimationUrl"
        :height="'100%'"
        :width="'100%'"
        :loop="scene4Loop"
        :autoplay="scene4Autoplay"
        @onComplete="$emit('lottie-complete')"
      />
    </div>

    <div class="drag-prompt">Drag the orb to the dog</div>
  </div>
</template>

<script setup>
import { ref, shallowRef, onMounted, defineProps, defineEmits, defineExpose } from 'vue';

defineProps({
  scene4AnimationUrl: String,
  scene4Loop: Boolean,
  scene4Autoplay: Boolean,
});

defineEmits(['lottie-complete']);

const scene4ContainerRef = ref(null);
const scene4LeftBoxRef = ref(null); // Still named this way to avoid breaking parent logic
const glowingBallRef = ref(null);
const dropTargetRef = ref(null);
const lottie4Ref = ref(null);
const lottieComponent = shallowRef(null);
const scene4TitleRef = ref(null);
const scene4SubtitleRef = ref(null);

onMounted(async () => {
  const { Vue3Lottie } = await import('vue3-lottie');
  lottieComponent.value = Vue3Lottie;
});

defineExpose({
  scene4ContainerRef,
  scene4LeftBoxRef,
  glowingBallRef,
  dropTargetRef,
  lottie4Ref,
  scene4TitleRef,
  scene4SubtitleRef,
});
</script>

<style scoped>
.scene4-container {
  position: absolute;
  inset: 0;
  pointer-events: none;
  opacity: 0;
  z-index: 2;
  overflow: hidden;
}

.scene4-left-box-wrapper {
  position: absolute;
  top: 50%;
  left: clamp(2rem, 6vw, 5rem);
  transform: translateY(-50%);
  pointer-events: auto;
  z-index: 5; /* ensure card sits above the orb initially */
}

.scene4-left-box {
  width: clamp(340px, 36vw, 560px);
  min-height: clamp(320px, 50vh, 460px);
  border: 1px solid rgba(255, 255, 255, 0.22);
  border-radius: 18px;
  background:
    linear-gradient(180deg, rgba(255,255,255,0.06) 0%, rgba(255,255,255,0.02) 100%),
    rgba(10, 12, 22, 0.45);
  backdrop-filter: blur(8px) saturate(120%);
  padding: clamp(1.75rem, 3.2vw, 2.5rem);
  color: #eef2ff;
  line-height: 1.6;
  box-shadow: 0 24px 48px rgba(0, 0, 0, 0.45), inset 0 1px 0 rgba(255,255,255,0.06);
}

.scene4-title {
  margin: 0 0 0.75rem 0;
  font-size: clamp(1.5rem, 2vw, 2.1rem);
  font-weight: 700;
  letter-spacing: 0.02em;
  color: #ffffff;
  font-family: 'Josefin Sans', sans-serif;
}

.scene4-subtitle {
  margin: 0;
  font-size: clamp(1.05rem, 1.35vw, 1.25rem);
  color: rgba(255, 255, 255, 0.85);
  line-height: 1.65;
  border-top: 1px dashed rgba(255, 255, 255, 0.15);
  padding-top: 0.75rem;
  opacity: 0; /* 初始隐藏，待动画显示 */
  transform: translateY(8px);
  font-family: 'Outfit', sans-serif;
}

.glowing-ball {
  position: absolute;
  /* default fallback: peek from card's bottom-left vicinity; JS will refine */
  bottom: clamp(2rem, 8vh, 3rem);
  left: clamp(1rem, 4vw, 2rem);
  width: clamp(42px, 5.5vw, 62px);
  height: clamp(42px, 5.5vw, 62px);
  background: radial-gradient(circle at 35% 35%, #ffe37a 0%, #ff9a00 70%);
  border-radius: 50%;
  box-shadow: 0 0 30px 10px rgba(255, 154, 0, 0.55);
  pointer-events: auto;
  cursor: grab;
  z-index: 1; /* behind the card, but still partially visible */
  transition: box-shadow 0.3s ease;
}

.glowing-ball:active {
  cursor: grabbing;
}

.lottie-drop-target {
  position: fixed;
  bottom: -2rem;
  right: -2rem;
  width: clamp(280px, 30vw, 420px);
  height: clamp(280px, 30vw, 420px);
  pointer-events: auto;
  background: transparent;
  border: none;
  overflow: hidden;
  z-index: 5;
}



.drag-prompt {
  position: absolute;
  top: clamp(6rem, 18vh, 10rem);
  left: clamp(4rem, 12vw, 10rem);
  color: rgba(255, 255, 255, 0.75);
  font-size: clamp(1.05rem, 1.35vw, 1.25rem);
  letter-spacing: 0.04em;
  font-family: 'Outfit', sans-serif;
}

@media (max-width: 768px) {
  .scene4-left-box-wrapper {
    top: 4rem;
    left: 50%;
    transform: translateX(-50%);
    right: auto;
  }
  .scene4-left-box {
    width: min(92vw, 440px);
    min-height: auto;
    padding: 1.5rem;
  }
  .glowing-ball {
    bottom: 4rem;
    right: 2rem;
    top: auto;
    left: auto;
  }
  .lottie-drop-target {
    right: -1rem;
    bottom: 5rem;
    width: min(80vw, 300px);
    height: min(80vw, 300px);
  }
  .drag-prompt {
    bottom: 8rem;
    top: auto;
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
  }
}
</style>